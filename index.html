<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cartas do Jogo PDP</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        text-align: center;
        padding: 20px;
        background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
        background-color: #f3f3f3;
      }
      h1 {
        margin-bottom: 30px;
      }
      .stage {
        display: inline-block;
        width: 220px;
        height: auto;
        min-height: 90px;
        margin: 10px;
        padding: 15px;
        background-color: #dbe9f4;
        border: 2px solid #007acc;
        border-radius: 12px;
        cursor: pointer;
        vertical-align: top;
        transition: 0.3s;
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2);
      }
      .stage:hover {
        background-color: #c0dcf0;
      }
      .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        z-index: 10;
      }
      .options button,
      .feedback-btns button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        transition: 0.2s;
      }
      .options button:hover,
      .feedback-btns button:hover {
        opacity: 0.9;
      }
      .card-output {
        margin-top: 20px;
        font-size: 18px;
        font-weight: bold;
        white-space: pre-line;
        min-height: 40px;
      }
      .feedback-btns {
        margin-top: 50px;
      }
      #modalTitle {
        margin-top: 0;
      }
    </style>
  </head>
  <body>
    <h1>Etapas do Desenvolvimento de Produto</h1>
    <div id="stages"></div>

    <div id="modal" class="modal">
      <h2 id="modalTitle"></h2>
      <p>Escolha o tipo de carta:</p>
      <div class="options">
        <button onclick="showCard('pergunta')">‚ùì Pergunta</button>
        <button onclick="showCard('consequencia')">‚ö†Ô∏è Consequ√™ncia</button>
        <button onclick="showCard('desafio')">üéØ Desafio</button>
        <button onclick="showCard('decisao')">üß† Tomada de Decis√£o</button>
      </div>
      <div class="card-output" id="cardOutput"></div>
      <button onclick="closeModal()">Fechar</button>
    </div>

    <div class="feedback-btns">
      <button
        style="background-color: #e74c3c; color: white"
        onclick="respostaErrada()"
      >
        ‚ùå Resposta Errada
      </button>
      <button
        style="background-color: #2ecc71; color: white"
        onclick="respostaCerta()"
      >
        üéâ Resposta Correta
      </button>
    </div>

    <audio
      id="somErro"
      src="https://www.soundjay.com/misc/sounds/fail-trombone-01.mp3"
    ></audio>
    <audio
      id="somAcerto"
      src="https://www.soundjay.com/human/sounds/applause-8.mp3"
    ></audio>
    <audio
      id="somFogos"
      src="https://www.soundjay.com/fireworks/fireworks-1.mp3"
    ></audio>

    <script>
      const etapas = [
        'Planejamento Estrat√©gico',
        'Planejamento do Projeto',
        'Projeto Informacional',
        'Projeto Conceitual',
        'Projeto Detalhado',
        'Prepara√ß√£o da Produ√ß√£o',
        'Lan√ßamento do Produto',
        'P√≥s desenvolvimento (acompanhamento e descontinuidade)',
      ];

      const stagesDiv = document.getElementById('stages');
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const cardOutput = document.getElementById('cardOutput');

      const discipline = 'Projeto e Desenvolvimento do Produto';
      const disciplineSyllabus =
        'Vis√£o geral do Processo de Desenvolvimento de Produtos. Ciclo de vida doproduto e an√°lise demercado. Metodologias do desenvolvimento de produto. Tipos de projeto do produto. Objetivos,t√©cnicas e ferramentas para o planejamento estrat√©gico de produtos. Planejamento do projeto. Projeto informacional. Projeto conceitual .Projeto detalhado.Prepara√ß√£o da produ√ß√£o lan√ßamento e acompanhamento doproduto no mercado. Engenharia simult√¢nea. Rela√ß√£o entre PDP e inova√ß√£o.';
      const topicContexts = {
        'Planejamento Estrat√©gico':
          'O Projeto Conceitual √© a valida√ß√£o de uma id√©ia, ou seja, √© a confirma√ß√£o de que a melhor solu√ß√£o est√° sendo proposta para atender a determinado requerimento ou necessidade nas diversas √°reas de uma planta industrial. √â portanto a fase inicial do processo de projeto de um produto ou instala√ß√£o. √â atrav√©s dele que s√£o concebidas as maneiras de solu√ß√£o para um determinado problema ou necessidade.',
        'Planejamento do Projeto': 'Contexto para Planejamento do Projeto',
        'Projeto Informacional': 'Contexto para Projeto Informacional',
        'Projeto Conceitual': 'Contexto para Projeto Conceitual',
        'Projeto Detalhado': 'Contexto para Projeto Detalhado',
        'Prepara√ß√£o da Produ√ß√£o': 'Contexto para Prepara√ß√£o da Produ√ß√£o',
        'Lan√ßamento do Produto': 'Contexto para Lan√ßamento do Produto',
        'P√≥s desenvolvimento (acompanhamento e descontinuidade)':
          'Contexto para P√≥s desenvolvimento',
      };

      etapas.forEach((etapa) => {
        const div = document.createElement('div');
        div.className = 'stage';
        div.textContent = etapa;
        div.onclick = () => openModal(etapa);
        stagesDiv.appendChild(div);
      });

      let etapaSelecionada = '';

      function openModal(etapa) {
        etapaSelecionada = etapa;
        modalTitle.textContent = etapa;
        cardOutput.textContent = '';
        modal.style.display = 'block';
      }

      async function showCard(tipo) {
        cardOutput.textContent = 'Buscando carta...';

        try {
          const response = await fetch('http://localhost:3000/generate-card', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              discipline,
              disciplineSyllabus,
              topic: etapaSelecionada,
              topicContext: topicContexts[etapaSelecionada] || '',
              type: mapTipo(tipo),
            }),
          });

          if (!response.ok) throw new Error('Erro na requisi√ß√£o');

          const data = await response.json();
          console.log('üîç Resposta da API:', data);

          if (data.card) {
            if (data.card.question && data.card.answer) {
              cardOutput.innerHTML = `
              ${data.card.question}
            `;
            } else {
              cardOutput.textContent = data.card;
            }
          } else {
            cardOutput.textContent = 'Resposta inv√°lida da API.';
          }
        } catch (err) {
          console.error(err);
          cardOutput.textContent = 'Erro ao buscar carta.';
        }
      }

      function mapTipo(tipoTela) {
        switch (tipoTela) {
          case 'pergunta':
            return 'question';
          case 'desafio':
            return 'challenge';
          case 'decisao':
            return 'decision';
          default:
            return 'question';
        }
      }

      function closeModal() {
        modal.style.display = 'none';
      }

      function respostaErrada() {
        document.body.style.backgroundColor = '#ffdddd';
        document.getElementById('somErro').play();
        setTimeout(() => {
          document.body.style.backgroundColor = '';
        }, 2000);
      }

      function respostaCerta() {
        document.body.style.backgroundColor = '#ddffdd';
        document.getElementById('somAcerto').play();
        setTimeout(() => {
          document.getElementById('somFogos').play();
        }, 1000);
        setTimeout(() => {
          document.body.style.backgroundColor = '';
        }, 3000);
      }
    </script>
  </body>
</html>
